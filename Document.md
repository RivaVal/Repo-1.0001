


            // 📋 ОБНОВЛЕННАЯ СТРУКТУРА ПРОЕКТА
            text
            /Ваш_Проект/
            ├── E49_Config.h
            ├── E49_Controller.h
            ├── E49_Controller.cpp
            ├── SPI_Manager.h          ← Исправленный
            ├── SPI_Manager.cpp        ← Исправленный  
            ├── ICM_Handler.h          ← Исправленный
            ├── ICM_Handler.cpp        ← Исправленный
            ├── SD_Handler.h
            ├── SD_Handler.cpp
            ├── Eleron_Controller.h
            └── main.ino
            //---------------------------------------------------------------------------------------------
  //  Полное описание работы системы
  //  1. Аппаратная часть
  //  Система предназначена для управления двумя однонаправленными бесколлекторными 
  //  моторами QX Motor QF(2827) 2227-1800KV через ESP32. Моторы подключаются:
  //      Мотор A: GPIO25 (PWM сигнал)
  //      Мотор B: GPIO26 (PWM сигнал)
  //========================================================================================
  //  2. Программная архитектура
  //========================================================================================
  //  Программа состоит из:
  //      Файла конфигурации (motor_config.h) - содержит все настраиваемые параметры
  //      Основного скетча - реализует логику управления
  //========================================================================================
  //  3. Алгоритм работы
  //========================================================================================
  //      Инициализация:
  //          Настройка MCPWM с указанной частотой и разрешением
  //          Создание и связывание таймеров, операторов, компараторов и генераторов
  //          Запуск таймеров
  //      Тестовая последовательность:
  //          Плавный старт (3 секунды разгона)
  //          Работа на 65% мощности (ровно 4 минуты)
  //          Плавная остановка (3 секунды)
  //      Защитные механизмы:
  //          Ограничение мощности (10%-80%)
  //          Плавные переходы между состояниями
  //          Проверка всех ошибок ESP32
  //========================================================================================
  //  4. Настройка параметров
  //========================================================================================
  //  Все параметры можно изменить в файле motor_config.h:
  //      PWM_FREQUENCY_HZ - частота ШИМ (рекомендуется 16 кГц)
  //      TEST_DURATION_MS - длительность теста (240000 мс = 4 мин)
  //      TEST_POWER_LEVEL - мощность при тесте (65%)
  //      MAX_DUTY_CYCLE - максимальная мощность (80%)
  //      
  //========================================================================================



Документация Receiver Controller
Обзор

Данный код представляет собой контроллер приемника для системы управления самолетом. Он обрабатывает команды, полученные через модуль EBYTE (LoRa), и управляет сервоприводами элеронов и моторами.
Архитектура
Модули системы:
    EBYTE Module - прием и передача данных по LoRa
    LEDC Eleron Module - управление сервоприводами элеронов
    MCPWM Motor Module - управление моторами
    Control Project Module - основной контроллер
Основные компоненты:
Структуры данных:
    ControllerDebug_t - флаги отладки
    DataComSet_t - структура команд управления
Конфигурация:
    Пины сервоприводов: GPIO 12, 13, 14, 33, 32
    Каналы LEDC: 0-4
    Частота ШИМ: 50 Гц
    Разрешение: 8 бит
Установка и настройка
Требования:
    ESP32 Dev Module
    Библиотеки: Arduino, ESP32 LEDC, MCPWM
Настройка пинов:
Измените константы в разделе конфигурации:

const int servoPins[] = {12, 13, 14, 33, 32};
Настройка отладки:
Измените флаги в структуре _debug для включения/выключения отладочной информации.
Использование
Основные функции:
    setup() - инициализация системы
    loop() - основной цикл обработки
    Eleron_LEDCV2_loop() - управление элеронами
    loop_ebyte() - обработка связи EBYTE
Отладка:
Включите соответствующие флаги отладки для мониторинга работы системы.
Решение проблем
Частые ошибки:
    Ошибки инициализации EBYTE:
        Проверьте подключение модуля
        Убедитесь в правильности настроек
    Дрожание сервоприводов:
        Проверьте питание
        Настройте параметры плавности
    Потеря связи:
        Проверьте антенны
        Убедитесь в совпадении каналов
Оптимизация
Для уменьшения потребления энергии:
    Увеличьте значения задержек
    Отключите неиспользуемые модули отладки
Для улучшения производительности:
    Оптимизируйте алгоритм плавного перемещения
    Увеличьте приоритет критических задач
Безопасность
    Всегда проверяйте предельные значения углов
    Реализуйте механизмы аварийной остановки
    Добавьте проверку контрольных сумм данных
Лицензия
Данный код распространяется под лицензией MIT.
Поддержка
Для вопросов и предложений обращайтесь к разработчику.
Этот код представляет собой надежную основу 
для системы управления приемником 
с возможностью расширения и модификации.
//===========================================================================

Документация для Receiver
Назначение модуля:
    Прием данных от удаленного Sender модуля
    Отправка подтверждений о получении (ACK)
    Контроль целостности данных
    Ведение статистики связи
Особенности реализации:
    Валидация пакетов - проверка преамбулы, ID и timestamp
    Статистика - подсчет принятых пакетов, ошибок, ACK
    Обработка ошибок - повторные попытки инициации
    Мониторинг - периодический вывод статуса
Настройки связи (должны совпадать с Sender!):
    Скорость UART: 9600 bps
    Скорость воздуха: 19200 bps
    Адрес: High=1, Low=101
    Канал: 17
    Мощность: 17 dBm
    FEC: Включено
Протокол связи:
    Sender отправляет данные с флагом ACK
    Receiver validates packet
    Если нужен ACK - Receiver отправляет подтверждение
    Sender получает ACK и обновляет статус
Диагностика:
    Проверка пина AUX перед операциями
    Подробное логирование всех событий
    Статистика каждые 10 секунд
    Авторестарт при критических ошибках
Рекомендации по использованию:
    Убедись в идентичности настроек на обоих модулях
    Проверь стабильность питания 3.3V
    Используй внешнюю антенну для лучшего сигнала
    Мониторь статистику для оптимизации параметров

Этот код обеспечит надежный прием данных с полной диагностикой и обработкой ошибок!
//==================================================================================
/* 
                           СХЕМА ПОДКЛЮЧЕНИЯ
                  +---------------------------+
                  |          ESP32            |		Modules
                  |                           |
                  | GPIO23 (VSPI_MOSI)  ------+-----> To ICM-20948 SDA
                  |                           |-----> To SD Module MOSI
                  |                           |
                  | GPIO19 (VSPI_MISO)  ------+-----> To ICM-20948 SDO/ADO
                  |                           |-----> To SD Module MISO
                  |                           |
                  | GPIO18 (VSPI_SCLK)  ------+-----> To ICM-20948 SCL
                  |                           |-----> To SD Module SCK
                  |                           |
                  | GPIO22 (Custom CS)  ------+-----> To ICM-20948 NCS
                  |                           |
                  | GPIO33 (Custom CS)  ------+-----> To SD Module CS
                  +---------------------------+
                  | GPIO16  (Pin -)-----------+-----> To E49 Module Rx
                  | GPIO17  (Pin -)-----------+-----> To E49 Module Tx
                  | GPIO4   (Pin -) ----------+-----> To E49 Module M0
                  | GPIO21  (Pin -)-----------+-----> To E49 Module M1
                  | GPIO5   (Pin -)-----------+-----> To E49 Module AUX
                  +---------------------------+
              25    | GPIO32  (Cuatom )---------+-----> To Motor_1 Control
              26    | GPIO33  (Cuatom )---------+-----> To Motor_2 Control
                  |                           |
                  | Gnd	----------------------+-----> To Motor_2 Gnd // Заземлить оба канала
                  | 			                    |-----> To Motor_2 Gnd // Заземлить оба канала
                  +---------------------------+
                  | GPIO12  (Castom PWM)------+-----> To Servo_1 Control
                  | GPIO13  (Castom PWM)------+-----> To Servo_2 Control
                  | GPIO14  (Castom PWM)------+-----> To Servo_3 Control
                  | GPIO27  (Castom PWM)------+-----> To Servo_4 Control
                  | GPIO26  (Castom PWM)------+-----> To Servo_5 Control
                  |---------------------------+
*/

/*
Анализ занятых пинов:
Уже используются:
    GPIO16 - E49_RX
    GPIO17 - E49_TX
    GPIO4 - E49_M0
    GPIO5 - E49_AUX
    GPIO21 - E49_M1 ✅ (закреплен)
    GPIO18 - VSPI_SCLK
    GPIO19 - VSPI_MISO
    GPIO23 - VSPI_MOSI
    GPIO22 - ICM_CS
    GPIO25 - Motor_1
    GPIO26 - MOTOR_2
    GPIO32 - ICM_INT
    GPIO33 - SD_CS
    GPIO12-14, 26-27 - сервоприводы
*/

/*
//4. Полная правильная конфигурация:

// E49_Config.h - ПРАВИЛЬНЫЕ пины:
const uint8_t E49_PIN_RX = 16;
const uint8_t E49_PIN_TX = 17; 
const uint8_t E49_PIN_M0 = 4;
const uint8_t E49_PIN_M1 = 21;  // ✅ Правильно - GPIO 21
const uint8_t E49_PIN_AUX = 5;

// SPI пины - СВОБОДНЫ от конфликтов:
#define VSPI_SCLK 18   // Только для SPI!
#define VSPI_MISO 19   // Только для SPI!  
#define VSPI_MOSI 23   // Только для SPI!
#define ICM_CS    22   // Любой свободны

*/

